name: Auto Greet Contributors

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]
  issue_comment:
    types: [created]

permissions:
  issues: write
  pull-requests: write

jobs:
  auto-greet:
    runs-on: ubuntu-latest
    steps:
      - name: Greet contributors on issues, PRs, and assign requests
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const eventName = context.eventName;
            const action = context.payload.action;

            // Helper: avoid replying to our own bot comments
            const actor = context.actor;
            if (actor === 'github-actions[bot]') {
              core.info('Skipping because actor is github-actions[bot]');
              return;
            }

            // 1) NEW ISSUE OPENED
            if (eventName === 'issues' && action === 'opened') {
              const body = `ğŸ‘‹ Thank you for taking the time to raise this issue!

We appreciate your contribution to improving the Project **EVID-DGC**. To help us address it effectively, please make sure you follow this: âš ï¸

### ğŸ“‹ Important Guidelines:
- ğŸ“– Follow the issue guidelines: https://github.com/Gooichand/blockchain-evidence/issues/50
- ğŸ“ Fill this form: https://forms.cloud.microsoft/r/0VjHehyNaw
- âœ… Use the issue template mentioned in pinned issue #50

### ğŸ•’ What's Next?
Our team will review your issue shortly. Stay tuned and have a happy contribution! ğŸš€

---
~ Team EVID-DGC ğŸ”`;

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                body
              });

              core.info('Posted welcome comment on new issue.');
              return;
            }

            // 2) NEW PULL REQUEST OPENED
            if (eventName === 'pull_request_target' && action === 'opened') {
              const body = `ğŸ‰ Thank you for submitting a pull request!

We appreciate the time and effort you've put into contributing to project **EVID-DGC**. To help us review your PR smoothly, please ensure that:

### âœ… PR Checklist:
- [ ] The PR description clearly explains the changes made
- [ ] **Video or image of changes** (ğŸ“¸ **COMPULSORY** if UI/frontend changes are applicable)
- [ ] Any related issues are linked (e.g., "Fixes #123")
- [ ] Tests or documentation updates are included if applicable
- [ ] Commit messages are descriptive and follow our guidelines

### ğŸ” Review Process:
Our team will review your PR as soon as possible. Feedback may be provided to ensure consistency with project standards. Collaboration is welcomeâ€”feel free to engage in discussion and iterate on the changes.

Your contribution helps make this project better for everyone! ğŸš€

---
~ Team EVID-DGC ğŸ”`;

              // PRs are also "issues" in the API
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                body
              });

              core.info('Posted welcome comment on new pull request.');
              return;
            }

            // 3) COMMENT ASKING FOR ASSIGNMENT
            if (eventName === 'issue_comment' && action === 'created') {
              const commentBody = context.payload.comment.body.toLowerCase();

              // Keywords that indicate someone wants to be assigned
              const keywords = [
                'assign me',
                'assign this to me',
                'can i work',
                'can i take',
                'i would like to work',
                'please assign',
                'can you assign',
                'i want to work on this'
              ];

              const isAssignRequest = keywords.some(keyword =>
                commentBody.includes(keyword)
              );

              if (!isAssignRequest) {
                core.info('Comment does not look like an assignment request. Skipping.');
                return;
              }

              const body = `ğŸ™Œ Thanks for your interest in working on this issue!

We'd be happy to assign this issue to you soon. Before you start, please make sure to:

### ğŸ“ Pre-Assignment Requirements:
- âœ… Fill this form: https://forms.cloud.microsoft/r/0VjHehyNaw
- ğŸ“‹ Follow proper order and workflow
- ğŸ’¡ **Comment your plan of action** to resolve this issue (required)

### ğŸ¯ Next Steps:
Based on your plan of action, the issue will be assigned to you. If you run into any blockers, feel free to ask questions or request guidance. 

Collaboration is always welcome, and we appreciate your contribution to improving this project! ğŸš€

---
~ Team EVID-DGC ğŸ”`;

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                body
              });

              core.info('Posted assignment guidance comment.');
              return;
            }

            core.info(`No matching handler for event: ${eventName} / action: ${action}`);